<header class="page-header">
  <h3><%= @posting.title %></h3>
  <h1><%= @posting.hiring_organization %></h1>
</header>


<section class="job-information">

  <h2>About this job</h2>

  <div class="controls">
  <%= link_to edit_posting_path(@posting) do %>
    <i class="icon-pencil2"><span>Edit</span></i>
  <% end %>

  <%= link_to posting_path(@posting), method: :delete, data: { confirm: 'Are you sure?' } do %>
    <i class="icon-trash2"><span>Delete</span></i>
  <% end %> 
  </div>

  <ul class="job-details">
    <% if @posting.date_posted %>
      <li><i class="icon-clock4"><span>Posted</span></i><%= @posting.date_posted.strftime("%B %d") %>
      (<%= link_to_if @posting.url, "Original post", @posting.url %>)
      </li>
    <% end %>

    <% if @posting.hiring_organization %>
      <li><i class="icon-location4"><span>Employer</span></i>
      <% if @posting.hiring_organization_url %>
        <%= link_to @posting.hiring_organization, @posting.hiring_organization_url %>
      <% else %>
        <%= @posting.hiring_organization %>
      <% end %>
      <% if @posting.job_location %>(<%= @posting.job_location %>)<% end %>
      </li>
    <% end %>

    <% if !@posting.application_url.empty? %>
      <li><i class="icon-external-link"><span>Online application</span></i><%= link_to 'URL', @posting.application_url %></li>
    <% end %>

    <% if !@posting.contact_name.empty? or !@posting.contact_email.empty? %>
      <li><i class="icon-user6"><span>Contact</span></i>
      <% if @posting.contact_name.empty? %>
        <%= link_to @posting.contact_email, @posting.contact_email %>
      <% elsif @posting.contact_email.empty? %>
        <%= @posting.contact_name %>
      <% else %>
        <%= link_to @posting.contact_name, @posting.contact_email %>
      <% end %>
      </li>

    <% end %>

    <% if @posting.submission_requirements %>
      <li><i class="icon-key2"><span>Application requirements</span></i><%= @posting.submission_requirements.downcase %></li>
    <% end %>        
  </ul>

  <div class="job-description">
    <%= simple_format(@posting.description) %>
  </div>

</section>


<section class="job-actions">

  <h2>Action items</h2>

  <% if @posting.applied? %>
  
    <% if @posting.followup_needed? %>
      <i class="applied icon-circle-blank todo"><span>Follow up</span></i>
    <% end %>

  <div class="accordion">
    <h3><i class="applied icon-checkmark done"><span>Application sent</span></i>
    <%= @posting.job_application.date_sent.strftime("%B %d") %></h3>
    <div class="notes">
      <%= simple_format(@posting.job_application.cover_letter) %>
    </div>
  </div>

  <% else %>
  <h3><i class="applied icon-circle-blank todo"><span>Send an application</span></i></h3>

    <%= form_for(@posting.job_application) do |f| %>

      <%= f.hidden_field :posting_id %>

      <%= f.label :"Date applied" %>
      <%= date_field :job_application, :date_sent, value: @posting.job_application.date_sent %>

      <%= f.label :"Enter cover letter and/or notes." %>
      <%= f.text_area :cover_letter %>

      <%= button_tag(:type => 'submit') do %>
        <i class="icon-checkmark"></i>Mark as applied
      <% end %>

    <% end %>

  <% end %>

</section>
